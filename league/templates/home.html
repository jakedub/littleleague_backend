
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://js.api.here.com/v3/3.1/here.js" type="text/javascript"></script>
    <title>Home</title>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js?apikey='3i6_xUsn7eU66y5VdaXzha5qwP_lFolNDSH9NUuPerc"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js?apikey='3i6_xUsn7eU66y5VdaXzha5qwP_lFolNDSH9NUuPerc"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js?apikey='3i6_xUsn7eU66y5VdaXzha5qwP_lFolNDSH9NUuPerc"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js?apikey='3i6_xUsn7eU66y5VdaXzha5qwP_lFolNDSH9NUuPerc"></script>
    <!-- Load the static template tag -->
    {% load static %}

    <!-- Link to your external JavaScript file -->
    <script src="{% static 'map.js' %}" defer></script>
</head>
<body>
    <h1>Welcome to the Little League Application!</h1>
    <p>Use the Geocode API to get coordinates from an address.</p>
    
    <!-- Geocode form -->
    <form action="{% url 'geocode' %}" method="get">
        <label for="address">Enter an Address:</label>
        <input type="text" id="address" name="address" required>
        <button type="submit">Get Geocode</button>
    </form>

    <h2>Map:</h2>
    <div id="map" style="width: 100%; height: 500px;"></div>

    <h2>Upload CSV File</h2>
    <form action="/upload-csv/" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="csv_file">Choose CSV File:</label>
        <input type="file" id="csv_file" name="csv_file" accept=".csv" required>
        <button type="submit">Upload</button>
    </form>

    <!-- Pass dynamic data into hidden input fields -->
    <input type="hidden" id="latitude" value="{{ latitude }}">
    <input type="hidden" id="longitude" value="{{ longitude }}">
    <input type="hidden" id="coordinates" value="{{ coordinates|escapejs }}">
    <input type="hidden" id="polygons" value="{{ polygons|escapejs }}">

    <script type="text/javascript">
      // Initialize the platform object with your API key
      var platform = new H.service.Platform({
        'apikey': '3i6_xUsn7eU66y5VdaXzha5qwP_lFolNDSH9NUuPerc'  // Replace with your actual API key
      });

      // Get the default map layers
      var defaultLayers = platform.createDefaultLayers();

      // Create a map instance
      var map = new H.Map(
        document.getElementById('map'),
        defaultLayers.vector.normal.map, // Use the normal map view
        {
          zoom: 10, // Zoom level
          center: { lat: parseFloat(document.getElementById('latitude').value), lng: parseFloat(document.getElementById('longitude').value) }  // Dynamically set the map center
        }
      );

      // Create markers from coordinates
      var coordinates = JSON.parse(document.getElementById('coordinates').value);
      coordinates.forEach(function(coord) {
          var marker = new H.map.Marker({ lat: coord[0], lng: coord[1] });
          map.addObject(marker);
      });

      // Add polygons to the map
      var polygons = JSON.parse(document.getElementById('polygons').value);
      polygons.forEach(function(polygonCoords) {
          var latLngs = polygonCoords.map(function(coord) {
              return { lat: coord[0], lng: coord[1] };
          });
          var polygon = new H.map.Polygon(latLngs);
          map.addObject(polygon);
      });
    </script>
</body>
</html>